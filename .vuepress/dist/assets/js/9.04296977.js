(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{306:function(t,a,e){"use strict";e.r(a);var r=e(17),n=Object(r.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"日志系统第一期的文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志系统第一期的文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 日志系统第一期的文档")]),t._v(" "),e("h3",{attrs:{id:"痛点："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#痛点：","aria-hidden":"true"}},[t._v("#")]),t._v(" 痛点：")]),t._v(" "),e("ul",[e("li",[t._v("前端无日志，或者有日志也无持久化，导致难以对线上问题进行追溯和分析")]),t._v(" "),e("li",[t._v("就算使用了前端日志库，通常也依赖于开发人员手动记日志，不可靠")]),t._v(" "),e("li",[t._v("生产环境中未捕获的异常往往都被忽略了")])]),t._v(" "),e("h3",{attrs:{id:"第一期目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第一期目标","aria-hidden":"true"}},[t._v("#")]),t._v(" 第一期目标")]),t._v(" "),e("p",[t._v("首先我们需要做的是日志的收集，分不同纬度，不同等级，不同的方式去采集。收集日志信息，我们先计划直接在浏览器控制台输出。")]),t._v(" "),e("p",[t._v("项目的搭建采用类似于babel的"),e("a",{attrs:{href:"https://github.com/babel/babel/blob/master/doc/design/monorepo.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("monorepo"),e("OutboundLink")],1),t._v("形式组织我们代码，每一个独立的模块就是一个packsge")]),t._v(" "),e("ul",[e("li",[t._v("logger，记录日志")]),t._v(" "),e("li",[t._v("拦截某些功能行为，例如AJAX调用logger记录")]),t._v(" "),e("li",[t._v("处理日志埋点代码的babel插件")])]),t._v(" "),e("h4",{attrs:{id:"埋点方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#埋点方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 埋点方式")]),t._v(" "),e("ul",[e("li",[t._v("手动埋点，根据业务需求（运营、产品、开发多个角度出发）在需要埋点地方手动调用埋点接口，采集埋点数据。")]),t._v(" "),e("li",[t._v("无痕埋点，")])]),t._v(" "),e("h4",{attrs:{id:"logger"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logger","aria-hidden":"true"}},[t._v("#")]),t._v(" logger")]),t._v(" "),e("p",[t._v("负责日志的打印，输出核心日志api，可配置不同级别日志的打印，主动收集日志各个维度的信息，日志的格式可以思考，那种方式看起来舒服，有辨识度，比如：")]),t._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("40.677")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("referrer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("os"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("browser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("resolution"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("projectId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INFO")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 这是一条info日志 会产生一个随机数： "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("主要支持"),e("strong",[t._v("手动埋点")])]),t._v(" "),e("p",[t._v("参考项目：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/latel/logline",target:"_blank",rel:"noopener noreferrer"}},[t._v("logline"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/houyhea/log4web",target:"_blank",rel:"noopener noreferrer"}},[t._v("log4web"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://blog.csdn.net/zzh920625/article/details/75810210",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文章"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"全局拦截"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局拦截","aria-hidden":"true"}},[t._v("#")]),t._v(" 全局拦截")]),t._v(" "),e("p",[t._v("拦截某些功能行为，例如AJAX调用logger记录")]),t._v(" "),e("p",[t._v("参考项目：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/eshengsky/lajax",target:"_blank",rel:"noopener noreferrer"}},[t._v("lajax"),e("OutboundLink")],1),t._v("：具有自动记录的功能")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/Pgyer/frontend-tracker",target:"_blank",rel:"noopener noreferrer"}},[t._v("frontend-tracker"),e("OutboundLink")],1),t._v("：主要是拦截XHR，提供参考")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/suguangwen/neky-err",target:"_blank",rel:"noopener noreferrer"}},[t._v("neky-err"),e("OutboundLink")],1),t._v("：主要是拦截XHR，提供参考")])]),t._v(" "),e("h4",{attrs:{id:"babel插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#babel插件","aria-hidden":"true"}},[t._v("#")]),t._v(" babel插件")]),t._v(" "),e("p",[t._v("为了提高手动埋点给代码的维护成本，我们同时采用如下方式：")]),t._v(" "),e("ul",[e("li",[t._v("利用yaml注释的方式标记日志，可以很容易的剔除掉我们所有的日志代，码维护成本低")]),t._v(" "),e("li",[t._v("也可以利用decorator（装饰器），拦截函数或者方法")])]),t._v(" "),e("p",[t._v("参考项目：")]),t._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"https://github.com/jonschlinkert/esprima-extract-comments",target:"_blank",rel:"noopener noreferrer"}},[t._v("获取注释"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/nodeca/js-yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("解析配置"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/istanbuljs/babel-plugin-istanbul",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-plugin-istanbul"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000020608635",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel创建自己的js语法"),e("OutboundLink")],1)])])])])},[],!1,null,null,null);a.default=n.exports}}]);