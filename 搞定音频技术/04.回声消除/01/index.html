<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog/umi.css" />
    <script>
      window.routerBase = "/blog";
    </script>
    <script>
      //! umi version: 3.5.17
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>07｜如何通过算法自动快速地消除回声？</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/搞定音频技术/04.回声消除/01" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>计算机基础<ul><li><a href="/blog/编译原理之美">编译原理之美</a></li><li><a href="/blog/编译原理实战">编译原理实战</a></li><li><a href="/blog/深入浅出计算机组成原理">深入浅出计算机组成原理</a></li><li><a href="/blog/详解http">详解http</a></li><li><a href="/blog/计算机网络通关29讲">计算机网络通关29讲</a></li><li><a href="/blog/网络排查案例课">网络排查案例课</a></li><li><a href="/blog/linux操作系统">linux操作系统</a></li><li><a href="/blog/linux性能优化实战">linux性能优化实战</a></li><li><a href="/blog/程序员数学基础">程序员数学基础</a></li><li><a href="/blog/趣谈网络协议">趣谈网络协议</a></li><li><a href="/blog/操作系统实战">操作系统实战</a></li><li><a href="/blog/软件工程之美">软件工程之美</a></li><li><a href="/blog/sql必知必会">sql必知必会</a></li><li><a href="/blog/操作系统实战45讲">操作系统实战45讲</a></li><li><a href="/blog/网络编程实战">网络编程实战</a></li></ul></span><span>算法<ul><li><a href="/blog/常用算法25讲">常用算法25讲</a></li><li><a href="/blog/数据结构与算法之美">数据结构与算法之美</a></li><li><a href="/blog/业务开发算法50讲">业务开发算法50讲</a></li><li><a href="/blog/动态规划面试宝典">动态规划面试宝典</a></li></ul></span><span>前端开发<ul><li><a href="/blog/浏览器工作原理与实践">浏览器工作原理与实践</a></li><li><a href="/blog/新时代产品经理进阶之路">新时代产品经理进阶之路</a></li><li><a href="/blog/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog/flutter核心技术与实战">flutter核心技术与实战</a></li><li><a href="/blog/java-script核心原理解析">java-script核心原理解析</a></li><li><a href="/blog/说透低代码">说透低代码</a></li><li><a href="/blog/nodejs应用开发实战">nodejs应用开发实战</a></li><li><a href="/blog/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li><li><a href="/blog/reactnative新架构实战课">reactnative新架构实战课</a></li><li><a href="/blog/正则表达式入门">正则表达式入门</a></li><li><a href="/blog/重学前端">重学前端</a></li><li><a href="/blog/serverless入门课">serverless入门课</a></li><li><a href="/blog/type-script入门实战笔记">type-script入门实战笔记</a></li><li><a href="/blog/图解googlev8">图解googlev8</a></li><li><a href="/blog/vue3源码分析">vue3源码分析</a></li><li><a href="/blog/玩转Vue3全家桶">玩转Vue3全家桶</a></li><li><a href="/blog/webassembly入门">webassembly入门</a></li><li><a href="/blog/手把手带你写一个Web框架">手把手带你写一个Web框架</a></li><li><a href="/blog/web漏洞挖掘实战">web漏洞挖掘实战</a></li><li><a href="/blog/跟月影学可视化">跟月影学可视化</a></li><li><a aria-current="page" class="active" href="/blog/搞定音频技术">搞定音频技术</a></li><li><a href="/blog/攻克视频技术">攻克视频技术</a></li></ul></span><span>前端工程化<ul><li><a href="/blog/logger">logger</a></li><li><a href="/blog/webpack">webpack</a></li><li><a href="/blog/webpackChain">webpackChain</a></li></ul></span><span>前端性能优化<ul><li><a href="/blog/react性能调优">react性能调优</a></li></ul></span><span>软件测试<ul><li><a href="/blog/全链路压测实战30讲">全链路压测实战30讲</a></li><li><a href="/blog/性能测试实战30讲">性能测试实战30讲</a></li><li><a href="/blog/自动化测试高手课">自动化测试高手课</a></li><li><a href="/blog/软件测试52讲">软件测试52讲</a></li></ul></span><span>面试<ul><li><a href="/blog/面试现场">面试现场</a></li></ul></span><span>杂谈<ul><li><a href="/blog/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a href="/blog/Git实战手册">Git实战手册</a></li><li><a href="/blog/NodeJS">NodeJS</a></li><li><a href="/blog/ReactJS">ReactJS</a></li><li><a href="/blog/UI设计">UI设计</a></li><li><a href="/blog/webpack4系列教程">webpack4系列教程</a></li><li><a href="/blog/前端知识体系">前端知识体系</a></li><li><a href="/blog/剑指offer刷题笔记">剑指offer刷题笔记</a></li><li><a href="/blog/思考与成长">思考与成长</a></li><li><a href="/blog/设计模式手册">设计模式手册</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>计算机基础<ul><li><a href="/blog/编译原理之美">编译原理之美</a></li><li><a href="/blog/编译原理实战">编译原理实战</a></li><li><a href="/blog/深入浅出计算机组成原理">深入浅出计算机组成原理</a></li><li><a href="/blog/详解http">详解http</a></li><li><a href="/blog/计算机网络通关29讲">计算机网络通关29讲</a></li><li><a href="/blog/网络排查案例课">网络排查案例课</a></li><li><a href="/blog/linux操作系统">linux操作系统</a></li><li><a href="/blog/linux性能优化实战">linux性能优化实战</a></li><li><a href="/blog/程序员数学基础">程序员数学基础</a></li><li><a href="/blog/趣谈网络协议">趣谈网络协议</a></li><li><a href="/blog/操作系统实战">操作系统实战</a></li><li><a href="/blog/软件工程之美">软件工程之美</a></li><li><a href="/blog/sql必知必会">sql必知必会</a></li><li><a href="/blog/操作系统实战45讲">操作系统实战45讲</a></li><li><a href="/blog/网络编程实战">网络编程实战</a></li></ul></li><li>算法<ul><li><a href="/blog/常用算法25讲">常用算法25讲</a></li><li><a href="/blog/数据结构与算法之美">数据结构与算法之美</a></li><li><a href="/blog/业务开发算法50讲">业务开发算法50讲</a></li><li><a href="/blog/动态规划面试宝典">动态规划面试宝典</a></li></ul></li><li>前端开发<ul><li><a href="/blog/浏览器工作原理与实践">浏览器工作原理与实践</a></li><li><a href="/blog/新时代产品经理进阶之路">新时代产品经理进阶之路</a></li><li><a href="/blog/全栈工程师修炼指南">全栈工程师修炼指南</a></li><li><a href="/blog/flutter核心技术与实战">flutter核心技术与实战</a></li><li><a href="/blog/java-script核心原理解析">java-script核心原理解析</a></li><li><a href="/blog/说透低代码">说透低代码</a></li><li><a href="/blog/nodejs应用开发实战">nodejs应用开发实战</a></li><li><a href="/blog/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li><li><a href="/blog/reactnative新架构实战课">reactnative新架构实战课</a></li><li><a href="/blog/正则表达式入门">正则表达式入门</a></li><li><a href="/blog/重学前端">重学前端</a></li><li><a href="/blog/serverless入门课">serverless入门课</a></li><li><a href="/blog/type-script入门实战笔记">type-script入门实战笔记</a></li><li><a href="/blog/图解googlev8">图解googlev8</a></li><li><a href="/blog/vue3源码分析">vue3源码分析</a></li><li><a href="/blog/玩转Vue3全家桶">玩转Vue3全家桶</a></li><li><a href="/blog/webassembly入门">webassembly入门</a></li><li><a href="/blog/手把手带你写一个Web框架">手把手带你写一个Web框架</a></li><li><a href="/blog/web漏洞挖掘实战">web漏洞挖掘实战</a></li><li><a href="/blog/跟月影学可视化">跟月影学可视化</a></li><li><a aria-current="page" class="active" href="/blog/搞定音频技术">搞定音频技术</a></li><li><a href="/blog/攻克视频技术">攻克视频技术</a></li></ul></li><li>前端工程化<ul><li><a href="/blog/logger">logger</a></li><li><a href="/blog/webpack">webpack</a></li><li><a href="/blog/webpackChain">webpackChain</a></li></ul></li><li>前端性能优化<ul><li><a href="/blog/react性能调优">react性能调优</a></li></ul></li><li>软件测试<ul><li><a href="/blog/全链路压测实战30讲">全链路压测实战30讲</a></li><li><a href="/blog/性能测试实战30讲">性能测试实战30讲</a></li><li><a href="/blog/自动化测试高手课">自动化测试高手课</a></li><li><a href="/blog/软件测试52讲">软件测试52讲</a></li></ul></li><li>面试<ul><li><a href="/blog/面试现场">面试现场</a></li></ul></li><li>杂谈<ul><li><a href="/blog/超级访谈对话张雪峰">超级访谈对话张雪峰</a></li><li><a href="/blog/Git实战手册">Git实战手册</a></li><li><a href="/blog/NodeJS">NodeJS</a></li><li><a href="/blog/ReactJS">ReactJS</a></li><li><a href="/blog/UI设计">UI设计</a></li><li><a href="/blog/webpack4系列教程">webpack4系列教程</a></li><li><a href="/blog/前端知识体系">前端知识体系</a></li><li><a href="/blog/剑指offer刷题笔记">剑指offer刷题笔记</a></li><li><a href="/blog/思考与成长">思考与成长</a></li><li><a href="/blog/设计模式手册">设计模式手册</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog/搞定音频技术">搞定音频技术</a></li><li><a href="/blog/搞定音频技术/01.开篇词">01.开篇词</a><ul><li><a href="/blog/搞定音频技术/01.开篇词/01"><span>开篇词｜实时互动强势发展，如何快速入门音频技术？</span></a></li></ul></li><li><a href="/blog/搞定音频技术/02.音频基础">02.音频基础</a><ul><li><a href="/blog/搞定音频技术/02.音频基础/01"><span>01｜声音是如何保存成数字信号的？</span></a></li><li><a href="/blog/搞定音频技术/02.音频基础/02"><span>02｜如何量化分析语音信号？</span></a></li><li><a href="/blog/搞定音频技术/02.音频基础/03"><span>03｜如何分析与处理音乐信号？</span></a></li><li><a href="/blog/搞定音频技术/02.音频基础/04"><span>04｜如何评价音频质量的好与坏？</span></a></li></ul></li><li><a href="/blog/搞定音频技术/03.音频降噪">03.音频降噪</a><ul><li><a href="/blog/搞定音频技术/03.音频降噪/01"><span>05｜音频降噪如何对症下药？</span></a></li><li><a href="/blog/搞定音频技术/03.音频降噪/02"><span>06｜如何将AI技术运用到降噪中？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog/搞定音频技术/04.回声消除">04.回声消除</a><ul><li><a aria-current="page" class="active" href="/blog/搞定音频技术/04.回声消除/01"><span>07｜如何通过算法自动快速地消除回声？</span></a></li><li><a href="/blog/搞定音频技术/04.回声消除/02"><span>08｜回声消除算法实践指南</span></a></li></ul></li><li><a href="/blog/搞定音频技术/05.音频网络传输">05.音频网络传输</a><ul><li><a href="/blog/搞定音频技术/05.音频网络传输/01"><span>09｜音频编解码器是如何工作的？</span></a></li><li><a href="/blog/搞定音频技术/05.音频网络传输/02"><span>10｜如何选择一个适合你的编解码器？</span></a></li><li><a href="/blog/搞定音频技术/05.音频网络传输/03"><span>11｜网络差怎么办？音频网络传输与抗弱网策略</span></a></li></ul></li><li><a href="/blog/搞定音频技术/06.空间音频">06.空间音频</a><ul><li><a href="/blog/搞定音频技术/06.空间音频/01"><span>12｜空间音频入门：如何实现“声临其境”？</span></a></li><li><a href="/blog/搞定音频技术/06.空间音频/02"><span>13｜如何利用HRTF实现听音辨位？</span></a></li></ul></li><li><a href="/blog/搞定音频技术/07.音频特效生成与算法">07.音频特效生成与算法</a><ul><li><a href="/blog/搞定音频技术/07.音频特效生成与算法/01"><span>14｜音效三剑客：变调、均衡器、混响</span></a></li><li><a href="/blog/搞定音频技术/07.音频特效生成与算法/02"><span>加餐｜音频技术漫谈之好声音是怎么炼成的？</span></a></li><li><a href="/blog/搞定音频技术/07.音频特效生成与算法/03"><span>15｜AI变声：音频AI技术的集大成者</span></a></li></ul></li><li><a href="/blog/搞定音频技术/08.结束语">08.结束语</a><ul><li><a href="/blog/搞定音频技术/08.结束语/01"><span>结束语｜选择比努力更重要</span></a></li><li><a href="/blog/搞定音频技术/08.结束语/02"><span>期末测试｜来赴一场满分之约吧！</span></a></li></ul></li><li><a href="/blog/搞定音频技术/summary">搞定音频技术</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="回声产生的原因" data-depth="2"><a href="/blog/搞定音频技术/04.回声消除/01#回声产生的原因"><span>回声产生的原因</span></a></li><li title="回声消除的基本原理" data-depth="2"><a href="/blog/搞定音频技术/04.回声消除/01#回声消除的基本原理"><span>回声消除的基本原理</span></a></li><li title="自适应滤波器" data-depth="2"><a href="/blog/搞定音频技术/04.回声消除/01#自适应滤波器"><span>自适应滤波器</span></a></li><li title="维纳滤波" data-depth="3"><a href="/blog/搞定音频技术/04.回声消除/01#维纳滤波"><span>维纳滤波</span></a></li><li title="LMS、NLSM算法" data-depth="3"><a href="/blog/搞定音频技术/04.回声消除/01#lmsnlsm算法"><span>LMS、NLSM算法</span></a></li><li title="线性滤波器的挑战和解决方法" data-depth="2"><a href="/blog/搞定音频技术/04.回声消除/01#线性滤波器的挑战和解决方法"><span>线性滤波器的挑战和解决方法</span></a></li><li title="延迟估计" data-depth="3"><a href="/blog/搞定音频技术/04.回声消除/01#延迟估计"><span>延迟估计</span></a></li><li title="双讲检测" data-depth="3"><a href="/blog/搞定音频技术/04.回声消除/01#双讲检测"><span>双讲检测</span></a></li><li title="非线性" data-depth="3"><a href="/blog/搞定音频技术/04.回声消除/01#非线性"><span>非线性</span></a></li><li title="小结" data-depth="2"><a href="/blog/搞定音频技术/04.回声消除/01#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog/搞定音频技术/04.回声消除/01#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="07如何通过算法自动快速地消除回声"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#07如何通过算法自动快速地消除回声"><span class="icon icon-link"></span></a>07｜如何通过算法自动快速地消除回声？</h1><p>你好，我是建元。</p><p>前面几节课，我们讲了实时音频前处理中的降噪算法。从这节课开始，我们将会看看语音交互或者说音频通信领域的另一项不可或缺的技术：声学回声消除（Acoustic Echo Cancellation, 简称AEC)。</p><p>回声消除算法在实时音频互动链路中和很多其它模块以及硬件都会有耦合。这节课我们主要看看实时音频互动链路中回声是如何产生的以及回声消除算法的基本原理。</p><p>需要注意的是，这节课涉及到的公式比较多。不过不用担心，只要你理解了原理，就很容易能明白公式的含义，从而能够记住公式的定义。</p><h2 id="回声产生的原因"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#回声产生的原因"><span class="icon icon-link"></span></a>回声产生的原因</h2><p>回声是如何产生的呢？我们可以通过下面的图来看一下，这是一个出现回声的经典场景。</p><p><img src="https://static001.geekbang.org/resource/image/0b/9b/0b5122405b7baeef466839555b1a109b.jpg?wh=1280x592" alt="图片" title="图1 回声产生的原理"/></p><p>图1中B端的人在说话，说话的声音会被B端的麦克风采集。麦克风采集到的语音信号转为数字信号后经过网络传输到A端，在A端的扬声器会把收到的语音信号转成声波播放出来，同时A端的麦克风又会把扬声器的声音采集回来，通过网络又传回给了B端。这时<strong>B端的人就会听到自己发出去的声音，我们把这个声音就叫做回声</strong>。</p><p>在音频实时互动的场景里，回声会严重影响通话体验，自己的声音不断被打断，而且对端的声音可能会和回声混在一起，这样会显著降低语音的可懂度。那么相对地，AEC的任务就是为了消除这个回声。在AB端互通的时候，我们需要使用AEC，在A端把麦克风采集到的信号中和B端相关的声音去掉，只保留A端的音源的声音发给B端。</p><p>**那么是不是把A端麦克风采集到的信号减去A端扬声器中的信号就能把回声消除了呢？**我们先来看看A端的回声消除的基本原理，再回过头来解答这个问题。</p><h2 id="回声消除的基本原理"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#回声消除的基本原理"><span class="icon icon-link"></span></a>回声消除的基本原理</h2><p>在近端接收到的远端的声音信号我们把它叫做参考信号$x(n)$。在经过扬声器播放、空气传播、房间墙体反射、麦克风采集后，参考信号不可避免地会产生很多变化。我们把这个变化用数学的方式来表达就叫做<strong>回声路径的传递函数</strong>，一般记作$f$。那么近端麦克风采集的<strong>回声信号</strong>$echo(n)$可以用公式1来表示：</p><p>$$echo(n)=f(x(n)) \text<!-- -->{<!-- --> 公式1<!-- -->}<!-- -->$$</p><p>近端除了回声信号还有近端自己的声音，比如近端人说话的声音。那么<strong>近端麦克风收到的信号$z(n)$其实是近端声音$y(n)$和回声信号之和</strong>，如公式2所示：</p><p>$$z(n)=echo(n)+y(n)\text<!-- -->{<!-- --> 公式2<!-- -->}<!-- -->$$</p><p>而<strong>回声消除算法的目的就是通过算法估计出回声路径的传递函数</strong>$f$，我们把算法估计出的传递函数定义为$f’$,那么经过回声消除后得到的近端信号$z’(n)$为公式3所示：</p><p>$$z’(n)=z(n)-f’(x(n))\text<!-- -->{<!-- --> 公式3<!-- -->}<!-- -->$$</p><p>将公式1和公式2代入公式3，我们可以得到公式4：</p><p>$$z’(n)=f(x(n))-f’(x(n))+y(n)\text<!-- -->{<!-- --> 公式4<!-- -->}<!-- -->$$</p><p>我们看到如果估计的传递函数$f’$和真实的传递函数$f$是一致的，那么回声就被完美消除了。但<strong>在真实的场景中传递函数的估计是一件比较困难的事情。</strong></p><p>这是因为AEC算法需要面对复杂的、时变的声学环境。比如，扬声器和麦克风的播放失真、采集失真会给声学信号带来很多非线性的变化，并且设备、系统调度的不稳定可能造成回声和远端接收信号的延迟抖动。同时诸如房间的混响、设备所处位置的变化，都会带来回声路径的变化。</p><p>因此，AEC算法必须能够快速地自适应地去估算出这些回声路径的变化。如果估计不准，就会导致回声泄漏或者近端声音被压制，甚至造成丢字、卡顿等现象，从而严重影响实时音频互动的质量。所以回到之前的问题，我们知道<strong>回声消除是做减法，但又不是直接相减就能解决。</strong></p><p>那么我们是<strong>如何让算法自动快速地进行回声消除呢</strong>？AEC技术经过半个多世纪的发展，在不断的实践中已经摸索出一套<strong>以自适应滤波为基础的回声消除方法</strong>。<strong>自适应滤波的核心思想</strong>就是用实时更新的滤波器的系数来模拟真实场景的回声路径，然后结合远端信号来估计出回声信号，再从近端采集的混合信号中减去估计的回声，从而达到消除回声的目的。</p><h2 id="自适应滤波器"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#自适应滤波器"><span class="icon icon-link"></span></a>自适应滤波器</h2><p>接下来我们就先来看看自适应滤波的基本原理。</p><h3 id="维纳滤波"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#维纳滤波"><span class="icon icon-link"></span></a>维纳滤波</h3><p>在一个相对稳定的声学环境中，回声路径中的延迟和房间的混响、音量大小的变化其实都可以看作是对远端信号做了一系列的线性变化。这种线性变化我们可以用一个线性离散的FIR线性滤波器来表示，公式1就变成了公式5：</p><p>$$echo’(n)=\sum_<!-- -->{<!-- -->k=0<!-- -->}<!-- -->^<!-- -->{<!-- -->\infty<!-- -->}<!-- -->{<!-- -->w_<!-- -->{<!-- -->k<!-- -->}<!-- -->}<!-- -->x(n-k),n=1,2,3,…\text<!-- -->{<!-- --> 公式5<!-- -->}<!-- -->$$</p><p>其中$w_<!-- -->{<!-- -->k<!-- -->}<!-- -->$代表第$k$个滤波器系数。如果在近端除了回声信号没有别的声音的时候，那么其实接收到的信号就是回声信号，即$z(n)=echo(n)$。这种情况我们一般叫做“<strong>单讲</strong>”。在这种情况下，我们的回声估计误差$e(n)$可用公式6表示：</p><p>$$e(n)=echo(n)-echo’(n)\text<!-- -->{<!-- --> 公式6<!-- -->}<!-- -->$$</p><p>你还记得之前降噪讲到过的降噪算法第三招中的<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/461590">维纳滤波<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>么？其实维纳滤波就是以估计误差e(n)的最小平方作为最优解的线性滤波器。也就是通过计算最小均方差（Mean Square Error，简称MSE）来求取滤波器系数$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->$（$w_<!-- -->{<!-- -->k<!-- -->}<!-- -->\in \mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->$）。公式7为求解最小MSE的代价函数。</p><p>$$\mathbf<!-- -->{<!-- -->J<!-- -->}<!-- -->=\mathbf<!-- -->{<!-- -->E<!-- -->}<!-- -->[e^<!-- -->{<!-- -->2<!-- -->}<!-- -->(n)]\text<!-- -->{<!-- --> 公式7<!-- -->}<!-- -->$$</p><p>我们知道想要让函数值最小，其实就是让函数的全微分等于0。其求解过程可以用维纳-霍夫方程来表示：</p><p>$$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->=\mathbf<!-- -->{<!-- -->R<!-- -->}<!-- -->^<!-- -->{<!-- -->-1<!-- -->}<!-- -->\mathbf<!-- -->{<!-- -->P<!-- -->}<!-- -->\text<!-- -->{<!-- --> 公式8<!-- -->}<!-- -->$$</p><p>其中，$\mathbf R$是参考信号$x(n)$序列的相关矩阵，$\mathbf<!-- -->{<!-- -->P<!-- -->}<!-- -->$是参考信号和回声信号$echo(n)$的互相关矢量。这样滤波器的系数似乎就可以得到了。但是你试想一下，假设音频的采样率是48kHz，如果只取1秒的信号来求解，那么$\mathbf R$矩阵的维度就是48000乘以48000。</p><p>显然要实时求一个这么大的矩阵的逆矩阵，算力是不可能支持实时计算的。我们把这种直接求得的解叫做维纳解，虽然它是最准确的，但是计算量过于庞大，而且当回声路径变化的时候我们需要重新计算维纳解。所以很显然<strong>维纳解并不适合在实时音频互动中使用</strong>。</p><p><strong>那么有什么办法能实时求解滤波器系数呢？<strong>其实自适应滤波器的核心思想是在面对回声路径不断变化的场景，比如移动电话等时，我们可以</strong>使用梯度下降法来迭代的计算滤波器系数</strong>。</p><p>在计算代价函数的时候我们让$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->$系数朝着梯度相反的方向或者说朝着减少代价函数的方向移动。随着迭代次数的增加，$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->$会逐渐的向维纳解收敛。这样当回声路径发生变化的时候，$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->$就会重新收敛，从而我们就可以实时的追踪回声路径的变化了。</p><p>那么这个迭代计算具体是怎么实现的呢？下面我们就通过两个算法来看一下迭代计算的过程。</p><h3 id="lmsnlsm算法"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#lmsnlsm算法"><span class="icon icon-link"></span></a>LMS、NLSM算法</h3><p>**最小均方算法LMS（Least Mean Square）是最早提出，也是最基础的自适应滤波方法。**它的基本原理可以表示为公式9：</p><p>$$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->(n+1)=\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->(n)+\mu \mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)\mathbf<!-- -->{<!-- -->e<!-- -->}<!-- -->(n)\text<!-- -->{<!-- --> 公式9<!-- -->}<!-- -->$$</p><p>其中，$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->(n)$代表第n次迭代时的滤波器的系数向量，$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$是第n次迭代的输入向量，$\mathbf<!-- -->{<!-- -->e<!-- -->}<!-- -->(n)$是第n次迭代的误差，$\mu$是步长因子。我们可以看到步长因子$\mu$决定了滤波器系数的收敛速度，且$\mu$越大收敛越快。</p><p>最小均方算法的梯度下降是随机的，随着迭代次数的增加它会不断逼近维纳解。但是我们看到公式9里梯度下降也会受到输入向量$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$大小的影响。也就是说，如果远端信号音量比较小，那这时系数向量的收敛速度会变得很慢；反过来，$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$很大的时候会导致梯度放大，从而系数向量的收敛变快。</p><p><strong>那么怎么解决这个音量变化带来的收敛波动问题呢？</strong></p><p>其实我们可以<strong>通过$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$的大小来动态调节步长因子，这样就可以把$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$进行归一化</strong>。这就是NLMS算法的由来。<strong>NLMS算法的迭代步骤</strong>如公式10、11所示：</p><p>$$\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->(n+1)=\mathbf<!-- -->{<!-- -->W<!-- -->}<!-- -->(n)+\mu(n) \mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)\mathbf<!-- -->{<!-- -->e<!-- -->}<!-- -->(n)\text<!-- -->{<!-- --> 公式10<!-- -->}<!-- -->$$</p><p>$$\mu(n)=\frac<!-- -->{<!-- -->\tilde<!-- -->{<!-- -->\mu<!-- -->}<!-- -->}<!-- -->{<!-- -->||\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)||^2+\delta<!-- -->}<!-- -->\text<!-- -->{<!-- --> 公式11<!-- -->}<!-- -->$$</p><p>其中，$\tilde<!-- -->{<!-- -->\mu<!-- -->}<!-- -->$是一个常量，取值范围在0～2，$\delta$为一个大于0的常数，主要是为了防止$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$过小导致的梯度爆炸。**NLMS相对于LMS通过归一化的方式提升了算法的收敛速度。**目前NLMS算法已经成为AEC算法中最常用的算法之一。</p><h2 id="线性滤波器的挑战和解决方法"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#线性滤波器的挑战和解决方法"><span class="icon icon-link"></span></a>线性滤波器的挑战和解决方法</h2><p>那么只有NLMS是不是就足够了呢？其实这里面还有三个很重要的问题没有解决。下面我就来简单介绍一下这三个问题。</p><h3 id="延迟估计"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#延迟估计"><span class="icon icon-link"></span></a>延迟估计</h3><p><strong>第一个问题是回声延迟</strong>。公式9～11中$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$是一段有限长度的输入信号，这个长度也就是我们常说的滤波器的感知长度。如果实际回声信号的传递路径很长，比如有很大的延迟和混响，那么我们就需要用一个很长的$\mathbf<!-- -->{<!-- -->X<!-- -->}<!-- -->(n)$作为输入才能估计出回声信号的传递函数。然而一个感知长度很大的滤波器需要的算力也会随之增加，这样就会对AEC的实时性造成挑战。</p><p>为了解决这个问题，最先想到的就是把延迟进行单独计算。我们可以看到假设回声信号的延迟为$dn$，那么在公式5里延迟的表示就是$w_<!-- -->{<!-- -->k<!-- -->}<!-- -->=0\text<!-- -->{<!-- -->，<!-- -->}<!-- -->k\in[0,dn-1]$。如果我们能够把延迟估计出来，那么权重为0的系数就不需要放到NLMS里去估计了，那么整体的算力就可以降下来。同时有了延迟估计，NLMS只需要估计后面非0部分的权重，从而收敛速度也可以变快。</p><p>延迟估计的方法也比较简单，其实就是移动远端信号的起始位置，然后和回声信号计算互相关性，并找到互相关最大的位置。这个位置就是我们要的延迟。</p><h3 id="双讲检测"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#双讲检测"><span class="icon icon-link"></span></a>双讲检测</h3><p><strong>第二个问题是双讲</strong>**。**前面讲维纳滤波的时候讲到了“单讲”。所谓“双讲”，就是远端和近端同时说话或者说两侧都有明显的声音。那在这个时候麦克风采集的信号除了回声还有混入了近端的声音。又NLMS是依赖于回声信号来进行估计的，而这时如果用麦克风采集的信号作为回声信号，就会导致滤波器无法收敛到正确的位置，从而产生回声泄漏或近端声音被损伤。</p><p>因此，我们一般会利用远端和近端信号先做一个简单的判断，此时是单讲还是双讲状态。如果是单讲，那么滤波器系数照常迭代更新；如果是双讲，则需要通过调节步长因子等方法停止或者减缓滤波器的更新。双讲检测的方法主要是结合能量和远、近端信号的相干性来做一个判断。如果远端和近端能量都比较高但是相干性却不强，那么就说明远端和近端都有声音，也就是双讲的状态。</p><p>这里你可以思考一下，我们在现实生活中可能经常会碰到的一个现象：如果和对方打网络电话的时候，我们从一个房间走到另一个房间，比如从会议室走到走廊，对面反馈说听到了回声。</p><p>这其实就和AEC的双讲时的策略有关，如果你和对端同时说话恰巧在此刻你换了个地方，也就是回声路径发生了改变。但由于是双讲的状态，滤波器没有及时更新，这时候就会漏回声。所以双讲检测可以防止滤波器发散。但这其实也并不是一个完美的解决方案，可能还会导致回声泄漏。只是这种双讲时，恰巧换房间的情况不是那么常见，所以双讲检测依然是回声策略中常见的调整依据。</p><h3 id="非线性"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#非线性"><span class="icon icon-link"></span></a>非线性</h3><p>第三个问题是我们看到NLMS等算法中实际上估计的是一个线性的滤波器。但是我们之前有讲到**扬声器、麦克风等都可能会导致一些非线性的变换。**那么这时线性滤波器可能就无法处理了。一般来说一些廉价或者说声学特性比较差的设备导致的非线性失真比较多，所以出现回声的概率也更大。</p><p>在实时音频互动刚开始的时候，其实大部分厂商都还是只有线性的回声消除。但现在我们一般会在线性回声处理之后再集联一个非线性处理，来解决这些线形处理后的残留回声。非线性建模需要兼顾不同设备、环境是一件很有挑战的事情。</p><p>除了传统算法，最近几年也有很多通过机器学习的方式来解决非线性的方案，并起到了比较好的效果。究其复杂性，非线性这块我们将会在下一讲中再继续展开来聊聊。</p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#小结"><span class="icon icon-link"></span></a>小结</h2><p>好的，我们这里总结一下。由于采集和播放设备的耦合，在实时音频互动领域，回声消除是实时音频链路中重要的一环。常见的回声消除流程包括双讲检测、延迟估计、线性回声消除、非线性回声消除等步骤。这里可以用一个流程图（图2）来总结一下，帮助你整体理解AEC的算法过程。<br/><img src="https://static001.geekbang.org/resource/image/18/7a/185e729081ef73b91246c1695e32357a.jpg?wh=1280x484" alt="图片" title="图2 回声消除的基本步骤"/></p><p>回声消除发展了几十年，依然还是一个比较热门的研究领域。究其原因还是因为它的复杂性，设备、环境、工程部署的实时性甚至是其它的音频模块都可能会对回声消除的效果产生影响。我们一般把回声消除模块放在紧挨着音频采集模块的位置。也就是说，做完了AEC再做降噪、增益调整等其它的音频模块。这样可以尽量减少音频处理对回声路径的复杂性的增加。</p><p>回声消除算法其实是在已知一个音源信号的条件下，在多音源混合的音频中消除这一音源。所以有的时候<strong>回声消除也被用来做一些音源分离的事情</strong>。比如一首歌你已经有伴奏的情况下，对人声和伴奏混合在一起的歌曲，用回声消除就可以提取到清唱（也就是没有伴奏的纯人声）。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog/搞定音频技术/04.回声消除/01#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>有的时候设备或者App在使用过程中还是会频繁地出现回声泄漏，但是带上耳机似乎大部分回声问题就可以解决，这背后的原理是什么呢？</p><p>你可以把你的答案和疑惑写下来，分享到留言区，与我一起讨论。我们下节课再见。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/docs/搞定音频技术/04.回声消除/01.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">5/2/2022 10:57:07</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog/umi.js"></script>
  </body>
</html>
